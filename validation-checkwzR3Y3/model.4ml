domain Net {
    Place ::= new (name: String).
    Transition ::= new (name: String).
    StartFlow ::= new (src: Place, dst: Transition).
    EndFlow ::= new (src: Transition, dst: Place).
}


domain PetriNets extends Net {
    Marks ::= fun (place: Place => val: Integer).
    StartWeight ::= fun (flow: StartFlow => val: Integer).
    EndWeight ::= fun (flow: EndFlow => val: Integer).
    
    negativeMarks ::= (Marks).
    negativeMarks(m) :- m is Marks(_, val), val < 0.

    nonPositiveWeights ::= (StartWeight + EndWeight).
    nonPositiveWeights(w) :- w is StartWeight(_, val), val < 1.
    nonPositiveWeights(w) :- w is EndWeight(_, val), val < 1.

    conforms no negativeMarks(_), no nonPositiveWeights(_).
    
    transitionEnabled ::= (Transition).
    transitionEnabled(t) :- t is Transition(_),
        no { p | p is Place(_), f is StartFlow(p, t), StartWeight(f, w), Marks(p, m), m < w }.
}


domain FreeChoicePetriNets extends PetriNets {
    freeChoice :- count({p|
        t1 is Transition(_), t2 is Transition(_), p is Place(_), t1 != t2,
        StartFlow(p, t1), StartFlow(p, t2)
    }) = 0.

    conforms freeChoice.
}


domain StateMachines extends PetriNets {
    notOneInPlace ::= (Transition).
    notOneInPlace(t) :- t is Transition, count({p | p is Place(_), StartFlow(p,t)}) != 1.
    notOneOutPlace ::= (Transition).
    notOneOutPlace(t) :- t is Transition, count({p | p is Place(_), EndFlow(t,p)}) != 1.

    conforms no notOneInPlace(_).
    conforms no notOneOutPlace(_).
}


domain MarkedGraphs extends PetriNets {
    notOneInTransition ::= (Place).
    notOneInTransition(p) :- p is Place(_), count({t | t is Transition(_), EndFlow(t,p)}) != 1.
    notOneOutTransition ::= (Place).
    notOneOutTransition(p) :- p is Place(_), count({t | t is Transition(_), StartFlow(p,t)}) != 1.

    conforms no notOneInTransition(_).
    conforms no notOneOutTransition(_).
}


domain WorkflowNets extends PetriNets {
    isSource ::= (Place).
    isSource(p) :- p is Place(_), count({t| t is Transition(_), EndFlow(t,p)}) = 0.
    notSingleSource :- count({p| isSource(p)}) != 1.

    countOuts ::= (Place, Integer).
    countOuts(p,i) :- p is Place(_), count({t| t is Transition(_), EndFlow(t,p)}) = i.

    isSink ::= (Place).
    isSink(p) :- p is Place(_), count({t| t is Transition(_), StartFlow(p,t)}) = 0.
    notSingleSink :- count({p| isSink(p)}) != 1.

    notOnPath ::= (Place + Transition).
    notOnPath(p) :- p is Place(_), no onPath(p).
    notOnPath(t) :- t is Transition(_), no onPath(t).

    onPath ::= (Place + Transition).
    onPath(p) :- isSource(p).
    onPath(p) :- isSink(p).
    onPath(pt) :- isSource(src), isSink(snk), pathSequence(src, pt, snk).

    pathSequence ::= (Place, Place + Transition, Place).
    pathSequence(i,x,o) :- i is Place(_), o is Place(_), pathExists(i,x), pathExists(x,o).

    pathExists ::= (Place + Transition, Place + Transition).
    pathExists(a,b) :- a is Place(_), b is Transition(_), StartFlow(a,b).
    pathExists(a,b) :- a is Transition(_), b is Place(_), EndFlow(a,b).
    pathExists(a,b) :- a is Place(_), x is Transition(_), StartFlow(a,x), pathExists(x,b).
    pathExists(a,b) :- a is Transition(_), x is Place(_), EndFlow(a,x), pathExists(x,b).


    conforms no notSingleSource.
    conforms no notSingleSink.
    conforms no notOnPath(_).
}


model PetriNet of PetriNets {
	
	p_cb04720c5d2eab5ab8dbdd2cfa461d55 is Place("P1").
    Marks(p_cb04720c5d2eab5ab8dbdd2cfa461d55, 0).

	p_b31f4f4b3c98407dfee9dc16bfa5198a is Place("P2").
    Marks(p_b31f4f4b3c98407dfee9dc16bfa5198a, 3).



	t_b8c0e7720cd81fa6b0633fe79bc4f683 is Transition("name").

	t_69dd64576e8a35b5f2183f9525c9d344 is Transition("name").



	s_9768113ff983ee4c606611b19fb394e8 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_9768113ff983ee4c606611b19fb394e8, 2).


	e_cb53cd959b1e91c3d87ffbc1a31fd6fd is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_cb53cd959b1e91c3d87ffbc1a31fd6fd, 1).


	s_211c16a758ee8b07464398bfdc1aa3cf is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_211c16a758ee8b07464398bfdc1aa3cf, 1).


	s_a39ae499c933a82748f1a5793e516a77 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_a39ae499c933a82748f1a5793e516a77, 1).


	e_ab15b4319cb42f0da2aa59db6fc02146 is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_ab15b4319cb42f0da2aa59db6fc02146, 5).



}

model PetriNet_freeChoice of FreeChoicePetriNets {
	
	p_cb04720c5d2eab5ab8dbdd2cfa461d55 is Place("P1").
    Marks(p_cb04720c5d2eab5ab8dbdd2cfa461d55, 0).

	p_b31f4f4b3c98407dfee9dc16bfa5198a is Place("P2").
    Marks(p_b31f4f4b3c98407dfee9dc16bfa5198a, 3).



	t_b8c0e7720cd81fa6b0633fe79bc4f683 is Transition("name").

	t_69dd64576e8a35b5f2183f9525c9d344 is Transition("name").



	s_9768113ff983ee4c606611b19fb394e8 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_9768113ff983ee4c606611b19fb394e8, 2).


	e_cb53cd959b1e91c3d87ffbc1a31fd6fd is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_cb53cd959b1e91c3d87ffbc1a31fd6fd, 1).


	s_211c16a758ee8b07464398bfdc1aa3cf is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_211c16a758ee8b07464398bfdc1aa3cf, 1).


	s_a39ae499c933a82748f1a5793e516a77 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_a39ae499c933a82748f1a5793e516a77, 1).


	e_ab15b4319cb42f0da2aa59db6fc02146 is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_ab15b4319cb42f0da2aa59db6fc02146, 5).



}

model PetriNet_stateMachine of StateMachines {
	
	p_cb04720c5d2eab5ab8dbdd2cfa461d55 is Place("P1").
    Marks(p_cb04720c5d2eab5ab8dbdd2cfa461d55, 0).

	p_b31f4f4b3c98407dfee9dc16bfa5198a is Place("P2").
    Marks(p_b31f4f4b3c98407dfee9dc16bfa5198a, 3).



	t_b8c0e7720cd81fa6b0633fe79bc4f683 is Transition("name").

	t_69dd64576e8a35b5f2183f9525c9d344 is Transition("name").



	s_9768113ff983ee4c606611b19fb394e8 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_9768113ff983ee4c606611b19fb394e8, 2).


	e_cb53cd959b1e91c3d87ffbc1a31fd6fd is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_cb53cd959b1e91c3d87ffbc1a31fd6fd, 1).


	s_211c16a758ee8b07464398bfdc1aa3cf is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_211c16a758ee8b07464398bfdc1aa3cf, 1).


	s_a39ae499c933a82748f1a5793e516a77 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_a39ae499c933a82748f1a5793e516a77, 1).


	e_ab15b4319cb42f0da2aa59db6fc02146 is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_ab15b4319cb42f0da2aa59db6fc02146, 5).



}

model PetriNet_markedGraph of MarkedGraphs {
	
	p_cb04720c5d2eab5ab8dbdd2cfa461d55 is Place("P1").
    Marks(p_cb04720c5d2eab5ab8dbdd2cfa461d55, 0).

	p_b31f4f4b3c98407dfee9dc16bfa5198a is Place("P2").
    Marks(p_b31f4f4b3c98407dfee9dc16bfa5198a, 3).



	t_b8c0e7720cd81fa6b0633fe79bc4f683 is Transition("name").

	t_69dd64576e8a35b5f2183f9525c9d344 is Transition("name").



	s_9768113ff983ee4c606611b19fb394e8 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_9768113ff983ee4c606611b19fb394e8, 2).


	e_cb53cd959b1e91c3d87ffbc1a31fd6fd is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_cb53cd959b1e91c3d87ffbc1a31fd6fd, 1).


	s_211c16a758ee8b07464398bfdc1aa3cf is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_211c16a758ee8b07464398bfdc1aa3cf, 1).


	s_a39ae499c933a82748f1a5793e516a77 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_a39ae499c933a82748f1a5793e516a77, 1).


	e_ab15b4319cb42f0da2aa59db6fc02146 is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_ab15b4319cb42f0da2aa59db6fc02146, 5).



}

model PetriNet_workflow of WorkflowNets {
	
	p_cb04720c5d2eab5ab8dbdd2cfa461d55 is Place("P1").
    Marks(p_cb04720c5d2eab5ab8dbdd2cfa461d55, 0).

	p_b31f4f4b3c98407dfee9dc16bfa5198a is Place("P2").
    Marks(p_b31f4f4b3c98407dfee9dc16bfa5198a, 3).



	t_b8c0e7720cd81fa6b0633fe79bc4f683 is Transition("name").

	t_69dd64576e8a35b5f2183f9525c9d344 is Transition("name").



	s_9768113ff983ee4c606611b19fb394e8 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_9768113ff983ee4c606611b19fb394e8, 2).


	e_cb53cd959b1e91c3d87ffbc1a31fd6fd is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_cb53cd959b1e91c3d87ffbc1a31fd6fd, 1).


	s_211c16a758ee8b07464398bfdc1aa3cf is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_211c16a758ee8b07464398bfdc1aa3cf, 1).


	s_a39ae499c933a82748f1a5793e516a77 is StartFlow(p_57f30c06fd426052326340d2a329fa33, t_57f30c06fd426052326340d2a329fa33).
    StartWeight(s_a39ae499c933a82748f1a5793e516a77, 1).


	e_ab15b4319cb42f0da2aa59db6fc02146 is EndFlow(t_57f30c06fd426052326340d2a329fa33, p_57f30c06fd426052326340d2a329fa33).
    EndWeight(e_ab15b4319cb42f0da2aa59db6fc02146, 5).



}
